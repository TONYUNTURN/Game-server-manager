# Game Server Manager (GSM)

一个基于 Shell 的轻量级 Linux 游戏服务器管理器，专为 NAT VPS 和独立服务器设计。
脚本集成了 SteamCMD，支持快速部署、管理和优化 Steam 游戏服务器。

## ✨ 功能特性

- **交互式管理**：提供简洁的菜单界面，支持安装、启动、停止、删除和监控服务器。
- **自动部署**：
  - 集成 **SteamCMD**，支持输入 AppID 自动下载和更新游戏服务端。
  - 自动解析游戏名称（支持本地缓存和联网获取）。
- **性能优化**：
  - **CPU 亲和性 (Affinity)**：自动绑定核心，避免通过 CPU 0 调度，提升性能。
  - **进程优先级调整**：自动调整进程 `nice` 和 `ionice` 值，确保游戏进程优先级。
  - **JVM 调优**：针对 Java 游戏（如 Minecraft, Project Zomboid）自动计算并应用内存参数。
  - **文件缓存**：支持使用 `vmtouch` 将关键配置文件锁定在内存中，减少 IO 延迟。
  - **智能看门狗**：内置 Watchdog 循环，监控高 CPU 占用进程并动态调整优先级。
- **数据安全**：
  - **安全删除**：删除服务器前强制确认，并提供“备份后删除”选项。
  - **数据隔离**：服务端文件 (`servers/`) 与 存档数据 (`data/`) 分离，便于管理。
- **便捷指令**：通过 `install.sh` 安装后，可直接使用 `gsm` 命令呼出菜单。

## 🛠️ 安装说明

### 环境要求
- **操作系统**: 推荐 Debian 12 (已在 Debian 12 上测试验证)。
- **用户权限**: 需要 `root` 权限运行。
- **依赖**: `curl`, `wget`, `screen`, `jq`, `tar` (脚本会自动尝试安装缺失依赖)。

### 快速安装 (一键脚本)
```bash
bash <(curl -Ls gsm.drumsticktony.online)
```

### 手动安装
如果你希望手动部署脚本：
```bash
# 1. 下载脚本
curl -O https://raw.githubusercontent.com/TONYUNTURN/Game-server-manager/main/gsm.sh
chmod +x gsm.sh

# 2. 运行
./gsm.sh
```

## 📖 使用指南

在终端输入 `gsm` (如果已通过 install.sh 安装) 或 `./gsm.sh` 启动管理菜单。

### 菜单选项说明
1.  **[1] 安装/更新服务器**
    - 输入 Steam AppID（例如 `108600` 是僵尸毁灭工程）。
    - 脚本会自动调用 SteamCMD 下载或验证服务端文件。
    - 安装完成后会自动记录到已知服务器列表。

2.  **[2] 启动服务器**
    - 选择已安装的服务器。
    - 脚本会自动检测启动脚本（如 `start-server.sh`）或二进制文件。
    - 首次启动时选择的启动命令会被**持久化保存**，下次无需再次选择。
    - 启动后并在 `screen` 后台运行。

3.  **[3] 停止服务器**
    - 优雅关闭后台的 `screen` 会话。

4.  **[4] 查看运行状态**
    - 列出当前所有正在运行的服务器 ID 和 Session 名称。

5.  **[5] 获取/更新服务器列表**
    - 从 GitHub 更新最新的 `known_servers.json` 数据库，以识别更多游戏名称。

6.  **[11] 删除服务器**
    - ⚠️ **危险操作**：彻底删除服务端文件和数据目录。
    - 提供删除前创建 `.tar.gz` 备份的选项。

### 常用命令
- **进入控制台**: 
  如果你想查看服务器后台日志或输入指令：
  ```bash
  screen -r game-<AppID>
  # 例如: screen -r game-108600
  # 退出控制台 (不停止服务器): 按 Ctrl+A 然后按 D
  ```

## 📂 目录结构

默认安装路径为 `/opt/gsm`：

| 目录/文件 | 说明 |
| :--- | :--- |
| `gsm.sh` | 主管理脚本 |
| `servers/` | 存放游戏服务端程序文件 (按 AppID 分类) |
| `data/` | 存放游戏存档、配置文件、备份数据 |
| `common/` | 存放 SteamCMD 程序及公共库文件 |
| `data/<AppID>/env.sh` | (可选) 用户自定义环境变量脚本，启动时自动加载 |

## ⚙️ 高级功能

### 自定义启动参数
- **启动记忆**: 首次启动游戏时，脚本会扫描目录下所有的可执行文件和 `.sh` 脚本供用户选择。选择后会自动记录。
- **环境注入**: 如果需要在启动前设置特定的环境变量，可以在 `data/<AppID>/env.sh` 中编写 Shell 脚本。

### 看门狗 (Watchdog)
脚本包含一个内部看门狗模式 (`__watchdog_internal`)，用于在后台循环检查游戏进程的 CPU 占用率，并自动进行 `renice` 优化。该功能通常由主脚本自启动，无需手动干预。

---
*License: MIT*
